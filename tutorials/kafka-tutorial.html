<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Kafka Tutorial</title>
<link rel="stylesheet" type="text/css" media="all" href="../style/gh-basic.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="../style/Dropdown.css" />
<script src="../style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
#markdown-toc ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="..">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="..">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      <li><a href="../operations-guide.html">SDK Operations Guide</a></li>
      
      <li><a href="../developer-guide.html">SDK Developer Guide</a></li>
      
      <li><a href="../yaml-reference.html">YAML Reference</a></li>
      
      <li><a href="../glossary.html">Glossary</a></li>
      
      <li><a href="../faq.html">Frequently Asked Questions</a></li>
      
      <li><a href="../ops-guide"></a></li>
      
      <li><a href="../swagger-api">REST APIs</a></li>
      <li><a href="../api">Javadoc Reference</a></li>
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="../tutorials/data-store-tutorial.html">Data Store Tutorial</a></li>
      
      <li><a href="../tutorials/kafka-tutorial.html">Kafka Tutorial</a></li>
      
      <li><a href="../tutorials/automatic-repair.html">Automatic Repair</a></li>
      
      <li><a href="../tutorials/quick-start-java.html">Quick Start (Java)</a></li>
      
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          <li><a href="../services/elastic/install.html">Install and Customize</a></li>
          
          <li><a href="../services/elastic/quick-start.html">Usage Example</a></li>
          
          <li><a href="../services/elastic/upgrade.html">Upgrade</a></li>
          
          <li><a href="../services/elastic/uninstall.html">Uninstall</a></li>
          
          <li><a href="../services/elastic/configure.html">Configuring</a></li>
          
          <li><a href="../services/elastic/x-pack.html">X-Pack</a></li>
          
          <li><a href="../services/elastic/connecting.html">Connecting Clients</a></li>
          
          <li><a href="../services/elastic/backup_restore.html">Backup and Restore</a></li>
          
          <li><a href="../services/elastic/managing.html">Managing</a></li>
          
          <li><a href="../services/elastic/api-reference.html">API Reference</a></li>
          
          <li><a href="../services/elastic/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../services/elastic/version_policy.html">Version Policy</a></li>
          
          <li><a href="../services/elastic/limitations.html">Limitations</a></li>
          
          <li><a href="../services/elastic/changelog.html">Changelog</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          <li><a href="../services/hdfs/quick-start.html">Quickstart</a></li>
          
          <li><a href="../services/hdfs/install.html">Install and Customize</a></li>
          
          <li><a href="../services/hdfs/uninstall.html">Uninstall</a></li>
          
          <li><a href="../services/hdfs/configure.html">Configuring</a></li>
          
          <li><a href="../services/hdfs/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../services/hdfs/limitations.html">Limitations</a></li>
          
          <li><a href="../services/hdfs/managing.html">Managing</a></li>
          
          <li><a href="../services/hdfs/api-reference.html">API Reference</a></li>
          
          <li><a href="../services/hdfs/troubleshooting.html">Troubleshooting</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          <li><a href="../services/kafka/install-and-customize.html">Install and Customize</a></li>
          
          <li><a href="../services/kafka/quick-start.html">Quick Start</a></li>
          
          <li><a href="../services/kafka/uninstall.html">Uninstall</a></li>
          
          <li><a href="../services/kafka/configure.html">Configure</a></li>
          
          <li><a href="../services/kafka/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../services/kafka/managing.html">Managing</a></li>
          
          <li><a href="../services/kafka/api-reference.html">API Reference</a></li>
          
          <li><a href="../services/kafka/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../services/kafka/version-policy.html">Version Policy</a></li>
          
          <li><a href="../services/kafka/limitations.html">Limitations</a></li>
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Kafka Tutorial</h1>
<div id="content">
<!--  disable mustache templating in this file: retain templated examples as-is -->

<p>In this tutorial we’ll be walking through step-by-step instructions on getting a Kafka service up and running. This tutorial assumes you’ve already setup a local cluster using the <a href="https://github.com/mesosphere/dcos-commons/blob/master/README.md">Quick Start</a> guide and that you’re in the VM environment.</p>

<h4 id="steps">Steps:</h4>

<ol>
  <li>
    <p>Change directory into <code class="highlighter-rouge">dcos-commons</code> and create a new service by running: <code class="highlighter-rouge">cd /dcos-commons &amp;&amp; ./new-framework.sh examples/kafka</code>. This will create a clone of the <code class="highlighter-rouge">hello-world</code> service which you should then modify.</p>
  </li>
  <li>
    <p>Next change directory to where the Kafka service definition is: <code class="highlighter-rouge">cd examples/kafka/src/main/dist/</code></p>
  </li>
  <li>
    <p>With an editor of your choice open <code class="highlighter-rouge">svc.yml</code>. Notice that some values, such as <code class="highlighter-rouge">NODE_COUNT</code> and
<code class="highlighter-rouge">FRAMEWORK_CPUS</code> are mustached.[0]</p>
  </li>
  <li>
    <p>The name of a task can be anything but since Kafka has brokers, change the type of the task in the Kafka pod from <code class="highlighter-rouge">node</code> to <code class="highlighter-rouge">broker</code>. Also, notice that <code class="highlighter-rouge">count</code> is specified as a property of the <code class="highlighter-rouge">kafka</code> pod. This indicates there will be <code class="highlighter-rouge">count</code> kafka pods, each of which will run a <code class="highlighter-rouge">broker</code>.</p>
  </li>
  <li>Next, add the following property to the <code class="highlighter-rouge">broker</code> task in order to open up the necessary port.
    <div class="highlighter-rouge"><pre class="highlight"><code>  ports:
 broker-port:
   port: 9092
</code></pre>
    </div>
  </li>
  <li>Now, let’s modify the command that will start each <code class="highlighter-rouge">broker</code>. This is also a property of the <code class="highlighter-rouge">broker</code> task:</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>cmd: "env &amp;&amp; exec $MESOS_SANDBOX/kafka_2.11-0.10.0.0/bin/kafka-server-start.sh $MESOS_SANDBOX/kafka_2.11-0.10.0.0/config/server.properties"
</code></pre>
</div>

<ol>
  <li>Adding this under <code class="highlighter-rouge">kafka</code> for each <code class="highlighter-rouge">broker</code> will fetch the Kafka binary in order to execute the above command:</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>uris:
    - "https://downloads.mesosphere.com/kafka/assets/kafka_2.11-0.10.0.0.tgz"
</code></pre>
</div>

<ol>
  <li>The following property allows for custom configuration of each <code class="highlighter-rouge">broker</code>:</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code>configs:
   server-properties:
      	template: "{{CONFIG_TEMPLATE_PATH}}/server.properties.mustache"
       	dest: "kafka_2.11-0.10.0.0/config/server.properties"
</code></pre>
</div>

<ol>
  <li>Save and exit the <code class="highlighter-rouge">svc.yml</code> file. It should look similar to the following:
```
name: {{FRAMEWORK_NAME}}
scheduler:
  principal: {{FRAMEWORK_PRINCIPAL}}
  user: {{FRAMEWORK_USER}}
pods:
  kafka:
 count: {{NODE_COUNT}}
 placement: {{NODE_PLACEMENT}}
 uris:
    <ul>
      <li>“https://downloads.mesosphere.com/kafka/assets/kafka_2.11-0.10.0.0.tgz”
 tasks:
   broker:
goal: RUNNING
cmd: “env &amp;&amp; exec $MESOS_SANDBOX/kafka_2.11-0.10.0.0/bin/kafka-server-start.sh $MESOS_SANDBOX/kafka_2.11-0.10.0.0/config/server.properties”
cpus: {{NODE_CPUS}}
memory: {{NODE_MEM}}
ports:
  broker-port:
    port: 9092
volume:
  path: “kafka-container-path”
  type: {{NODE_DISK_TYPE}}
  size: {{NODE_DISK}}
env:
  SLEEP_DURATION: {{SLEEP_DURATION}}
configs:
  server-properties:
    template: “{{CONFIG_TEMPLATE_PATH}}/server.properties.mustache”
    dest: “kafka_2.11-0.10.0.0/config/server.properties”
```
The <code class="highlighter-rouge">server.properties.mustache</code> should live in the current directory (<code class="highlighter-rouge">dcos-commons/examples/kafka/src/main/dist</code>).</li>
    </ul>
  </li>
  <li>Download the <code class="highlighter-rouge">server.properties.mustache</code> file mentioned above:
    <div class="highlighter-rouge"><pre class="highlight"><code>   curl -O https://raw.githubusercontent.com/mesosphere/dcos-commons/29c38ea81948c8fe550a9d77974f78155c318815/frameworks/kafka/src/main/dist/server.properties.mustache &gt; server.properties.mustache
</code></pre>
    </div>
  </li>
  <li>Next, create the symlink that’s required to get the unit tests to pass and confirm that it’s created:
    <div class="highlighter-rouge"><pre class="highlight"><code>   cd ../resources &amp;&amp; ln -s ../dist/server.properties.mustache &amp;&amp; ls -l
</code></pre>
    </div>
  </li>
  <li>Open <code class="highlighter-rouge">/dcos-commons/examples/kafka/src/test/java/com/mesosphere/sdk/kafka/scheduler/ServiceSpecTest.java</code> and add the following beneath the currently set environment variables and make sure to import the URL type:
    <div class="highlighter-rouge"><pre class="highlight"><code>   // place at top
   import java.net.URL;
   import java.io.File;
</code></pre>
    </div>
    <div class="highlighter-rouge"><pre class="highlight"><code>   URL resource = ServiceSpecTest.class.getClassLoader().getResource("server.properties.mustache");
   ENV_VARS.set("CONFIG_TEMPLATE_PATH", new File(resource.getPath()).getParent());
</code></pre>
    </div>
  </li>
  <li>Save and exit the file. Next, open <code class="highlighter-rouge">/dcos-commons/examples/kafka/universe/marathon.json.mustache</code> and add the following as the first item of the <code class="highlighter-rouge">env</code> list:
    <div class="highlighter-rouge"><pre class="highlight"><code>   "CONFIG_TEMPLATE_PATH": "kafka-scheduler",
</code></pre>
    </div>
  </li>
  <li>Run the following command from the root directory of the service:
    <div class="highlighter-rouge"><pre class="highlight"><code> cd /dcos-commons/examples/kafka &amp;&amp; ./build.sh local
</code></pre>
    </div>
    <p>Depending on your implementation, you may need to configure</p>
    <div class="highlighter-rouge"><pre class="highlight"><code>   ln -s /usr/bin/sha1sum /usr/bin/shasum
</code></pre>
    </div>
  </li>
  <li>Now, install the service via <code class="highlighter-rouge">dcos package install kafka</code> and visit your dashboard to see Kafka running: http://172.17.0.2/#/services/%2Fkafka/</li>
</ol>

<p>[0] The mustaching provides support for dynamically updating a service’s configuration at runtime.</p>

</div>
</div>
</body>

</html>
