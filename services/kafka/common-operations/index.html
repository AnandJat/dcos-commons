<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Kafka: Common Operations</title>
<link rel="stylesheet" type="text/css" media="all" href="/dcos-commons/style/layout.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="/dcos-commons/style/Dropdown.css" />
<script src="/dcos-commons/style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
.section-nav ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="/dcos-commons">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="/dcos-commons">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      
      <li><a href="/dcos-commons/operations-guide/">SDK Operations Guide</a></li>
      
      
      
      <li><a href="/dcos-commons/developer-guide/">SDK Developer Guide</a></li>
      
      
      
      <li><a href="/dcos-commons/yaml-reference/">YAML Reference</a></li>
      
      
      
      <li><a href="/dcos-commons/faq/">Frequently Asked Questions</a></li>
      
      
      
      <li><a href="/dcos-commons/glossary/">Glossary</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li><a href="/dcos-commons/reference/api">Javadoc Reference</a></li>
      <li><a href="/dcos-commons/reference/swagger-api">REST APIs</a></li>
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="/dcos-commons/tutorials/kafka-tutorial/">Kafka Tutorial</a></li>
      
      <li><a href="/dcos-commons/tutorials/secrets-tutorial/">Secrets Tutorial</a></li>
      
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Cassandra</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/service-settings/">Service Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/cassandra-settings/">Cassandra Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/node-settings/">Node Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/common-operations/">Common Operations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/diagnostic-tools/">Diagnostic Tools</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/overview/">Overview</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/disaster-recovery/">Disaster Recovery</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/elastic/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/elastic-x-pack/">X-Pack</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/custom-elasticsearch-yaml/">Custom Elasticsearch YAML</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/common-operations/">Common Operations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/diagnostic-tools/">Diagnostic Tools</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/overview/">Overview</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/disaster-recovery/">Disaster Recovery</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/security/">Security</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/common-operations/">Common Operations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/overview/">Overview</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/diagnostic-tools/">Diagnostic Tools</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/kafka/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/security/">Security</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/common-operations/">Common Operations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/overview/">Overview</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/diagnostic-tools/">Diagnostic Tools</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Kafka: Common Operations</h1>
<div id="content">


<p>This guide has so far focused on describing the components, how they work, and how to interact with them. At this point we’ll start looking at how that knowledge can be applied to a running service.</p>

<h2 id="initial-service-configuration">Initial service configuration</h2>

<p>The DC/OS package format allows packages to define user-visible installation options. To ensure consistent installations, we recommend exporting the options you use into an <code class="highlighter-rouge">options.json</code> file, which can then be placed in source control and kept up to date with the current state of the cluster. Keeping these configurations around will make it easy to duplicate or reinstall services using identical configurations.</p>

<p>Use this CLI command to see what options are available for a given package:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package describe elastic <span class="nt">--config</span>
<span class="o">{</span>
  <span class="s2">"properties"</span>: <span class="o">{</span>
    <span class="s2">"coordinator_nodes"</span>: <span class="o">{</span>
      <span class="s2">"description"</span>: <span class="s2">"Elasticsearch coordinator node configuration properties"</span>,
      <span class="s2">"properties"</span>: <span class="o">{</span>
        <span class="s2">"count"</span>: <span class="o">{</span>
          <span class="s2">"default"</span>: 1,
          <span class="s2">"description"</span>: <span class="s2">"Number of coordinator nodes to run"</span>,
          <span class="s2">"minimum"</span>: 0,
          <span class="s2">"type"</span>: <span class="s2">"integer"</span>
        <span class="o">}</span>,
        <span class="s2">"cpus"</span>: <span class="o">{</span>
          <span class="s2">"default"</span>: 1.0,
          <span class="s2">"description"</span>: <span class="s2">"Node cpu requirements"</span>,
          <span class="s2">"type"</span>: <span class="s2">"number"</span>
        <span class="o">}</span>,
        ...
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="s2">"service"</span>: <span class="o">{</span>
      <span class="s2">"description"</span>: <span class="s2">"DC/OS service configuration properties"</span>,
      <span class="s2">"properties"</span>: <span class="o">{</span>
        ...
        <span class="s2">"name"</span>: <span class="o">{</span>
          <span class="s2">"default"</span>: <span class="s2">"elastic"</span>,
          <span class="s2">"description"</span>: <span class="s2">"The name of the Elasticsearch service instance"</span>,
          <span class="s2">"type"</span>: <span class="s2">"string"</span>
        <span class="o">}</span>,
        ...
        <span class="s2">"user"</span>: <span class="o">{</span>
          <span class="s2">"default"</span>: <span class="s2">"core"</span>,
          <span class="s2">"description"</span>: <span class="s2">"The user that runs the Elasticsearch services and owns the Mesos sandbox."</span>,
          <span class="s2">"type"</span>: <span class="s2">"string"</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
...
</code></pre></div></div>

<p>Given the above example, let’s build an <code class="highlighter-rouge">elastic-prod-options.json</code> that customizes the above values:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"coordinator_nodes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="s2">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="mf">2.0</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elastic-prod"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elastic"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now that we have <code class="highlighter-rouge">elastic-prod-options.json</code>, we can install a service instance that uses it as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package <span class="nb">install</span> <span class="nt">--options</span><span class="o">=</span>elastic-prod-options.json elastic
</code></pre></div></div>

<p>Once we know the configuration is good, it should be added to our source control for tracking.</p>

<h2 id="updating-service-configuration">Updating service configuration</h2>

<p>Above, we described how a configuration update (including updating the version of the service) is handled. Now we will quickly show the steps to perform such an update.</p>

<p>Configuration updates are performed by updating the process environment of the Scheduler. Once restarted, the Scheduler will observe this change and re-deploy nodes as described in <a href="#Reconfiguration">Reconfiguration</a>.</p>

<h3 id="enterprise-dcos-110">Enterprise DC/OS 1.10</h3>

<p>Enterprise DC/OS 1.10 introduces a convenient command line option that allows for easier updates to a service’s configuration, as well as allowing users to inspect the status of an update, to pause and resume updates, and to restart or complete steps if necessary.</p>

<h4 id="prerequisites">Prerequisites</h4>

<ul>
  <li>Enterprise DC/OS 1.10 or newer.</li>
  <li>A DC/OS SDK-based service with a version greater than 2.0.0-x.</li>
  <li><a href="https://docs.mesosphere.com/latest/cli/install/">The DC/OS CLI</a> installed and available.</li>
  <li>The service’s subcommand available and installed on your local machine.
    <ul>
      <li>You can install just the subcommand CLI by running <code class="highlighter-rouge">dcos package install --cli &lt;service-name&gt;</code>.</li>
      <li>If you are running an older version of the subcommand CLI that doesn’t have the <code class="highlighter-rouge">update</code> command, uninstall and reinstall your CLI.
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos package uninstall <span class="nt">--cli</span> &lt;service-name&gt;
dcos package <span class="nb">install</span> <span class="nt">--cli</span> &lt;service-name&gt;
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h5 id="updating-package-version">Updating package version</h5>

<p>The instructions below show how to safely update one version of a service to the next.</p>

<h6 id="viewing-available-versions">Viewing available versions</h6>

<p>The <code class="highlighter-rouge">update package-versions</code> command allows you to view the versions of a service that you can upgrade or downgrade to. These are specified by the service maintainer and depend on the semantics of the service (i.e. whether or not upgrades are reversal).</p>

<p>For example, for <code class="highlighter-rouge">dse</code>, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update package-versions
</code></pre></div></div>

<h6 id="upgrading-or-downgrading-a-service">Upgrading or downgrading a service</h6>

<ol>
  <li>Before updating the service itself, update its CLI subcommand to the new version:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package uninstall <span class="nt">--cli</span> dse
<span class="nv">$ </span>dcos package <span class="nb">install</span> <span class="nt">--cli</span> dse <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div>    </div>
  </li>
  <li>Once the CLI subcommand has been updated, call the update start command, passing in the version. For example, to update <code class="highlighter-rouge">dse</code> to version <code class="highlighter-rouge">1.1.6-5.0.7</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update start <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>If you are missing mandatory configuration parameters, the <code class="highlighter-rouge">update</code> command will return an error.</p>

<p>To supply missing configuration values or to override configuration values, you can also provide an <code class="highlighter-rouge">options.json</code> file (see <a href="#updating-configuration">Updating configuration</a> below):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update start <span class="nt">--options</span><span class="o">=</span>options.json <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div></div>

<p>The default behavior on update is to merge ‘Default’, ‘Stored’ and ‘Provided’ configurations, in that order, and then
validate against the schema. In some situations, such as when a schema option has been removed, the default behavior
might result in an invalid configuration. You can work around this with <code class="highlighter-rouge">--replace=true</code> which, when specified,
will override the ‘Stored’ options with the ‘Provided’ options.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update start <span class="nt">--options</span><span class="o">=</span>options.json <span class="nt">--replace</span><span class="o">=</span><span class="nb">true</span> <span class="nt">--package-verion</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div></div>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<h5 id="updating-configuration">Updating configuration</h5>

<p>The instructions below describe how to update the configuration for a running DC/OS service.</p>

<h6 id="preparing-configuration">Preparing configuration</h6>

<p>If you installed this service with Enterprise DC/OS 1.10, you can fetch the full configuration of a service (including any default values that were applied during installation). For example, for <code class="highlighter-rouge">dse</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse describe <span class="o">&gt;</span> options.json
</code></pre></div></div>

<p>Make any configuration changes to this <code class="highlighter-rouge">options.json</code> file.</p>

<p>If you installed this service with a prior version of DC/OS, this configuration will not have been persisted by the DC/OS package manager. You can instead use the <code class="highlighter-rouge">options.json</code> file that was used when <a href="#initial-service-configuration">installing the service</a>.</p>

<p><strong>Note:</strong> You need to specify all configuration values in the <code class="highlighter-rouge">options.json</code> file when performing a configuration update. Any unspecified values will be reverted to the default values specified by the DC/OS service. See the “Recreating <code class="highlighter-rouge">options.json</code>” section below for information on recovering these values.</p>

<p>####### Recreating <code class="highlighter-rouge">options.json</code> (optional)</p>

<p>If the <code class="highlighter-rouge">options.json</code> from when the service was last installed or updated is not available, you will need to manually recreate it using the following steps.</p>

<p>First, we’ll fetch the default application’s environment, current application’s environment, and the actual template that maps config values to the environment:</p>

<ol>
  <li>Ensure you have <a href="https://stedolan.github.io/jq/">jq</a> installed.</li>
  <li>Set the service name that you’re using, in this example we’ll use <code class="highlighter-rouge">dse</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ SERVICE_NAME</span><span class="o">=</span>dse
</code></pre></div>    </div>
  </li>
  <li>Get the version of the package that is currently installed:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ PACKAGE_VERSION</span><span class="o">=</span><span class="k">$(</span>dcos package list | <span class="nb">grep</span> <span class="nv">$SERVICE_NAME</span> | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>Then fetch and save the environment variables that have been set for the service:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos marathon app show <span class="nv">$SERVICE_NAME</span> | jq .env <span class="o">&gt;</span> current_env.json
</code></pre></div>    </div>
  </li>
  <li>To identify those values that are custom, we’ll get the default environment variables for this version of the service:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package describe <span class="nt">--package-version</span><span class="o">=</span><span class="nv">$PACKAGE_VERSION</span> <span class="nt">--render</span> <span class="nt">--app</span> <span class="nv">$SERVICE_NAME</span> | jq .env <span class="o">&gt;</span> default_env.json
</code></pre></div>    </div>
  </li>
  <li>We’ll also get the entire application template:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package describe <span class="nv">$SERVICE_NAME</span> <span class="nt">--app</span> <span class="o">&gt;</span> marathon.json.mustache
</code></pre></div>    </div>
  </li>
</ol>

<p>Now that you have these files, we’ll attempt to recreate the <code class="highlighter-rouge">options.json</code>.</p>

<ol>
  <li>Use JQ and <code class="highlighter-rouge">diff</code> to compare the two:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff &lt;<span class="o">(</span>jq <span class="nt">-S</span> <span class="nb">.</span> default_env.json<span class="o">)</span> &lt;<span class="o">(</span>jq <span class="nt">-S</span> <span class="nb">.</span> current_env.json<span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>Now compare these values to the values contained in the <code class="highlighter-rouge">env</code> section in application template:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>less marathon.json.mustache
</code></pre></div>    </div>
  </li>
  <li>Use the variable names (e.g. <code class="highlighter-rouge">&lt;%==%&gt;</code>) to create a new <code class="highlighter-rouge">options.json</code> file as described in <a href="#initial-service-configuration">Initial service configuration</a>.</li>
</ol>

<h6 id="starting-the-update">Starting the update</h6>

<p>Once you are ready to begin, initiate an update using the DC/OS CLI, passing in the updated <code class="highlighter-rouge">options.json</code> file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update start <span class="nt">--options</span><span class="o">=</span>options.json
</code></pre></div></div>

<p>You will receive an acknowledgement message and the DC/OS package manager will restart the Scheduler in Marathon.</p>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<h5 id="advanced-update-actions">Advanced update actions</h5>

<p>The following sections describe advanced commands that be used to interact with an update in progress.</p>

<h6 id="monitoring-the-update">Monitoring the update</h6>

<p>Once the Scheduler has been restarted, it will begin a new deployment plan as individual pods are restarted with the new configuration. Depending on the high availability characteristics of the service being updated, you may experience a service disruption.</p>

<p>You can query the status of the update as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update status
</code></pre></div></div>

<p>If the Scheduler is still restarting, DC/OS will not be able to route to it and this command will return an error message. Wait a short while and try again. You can also go to the Services tab of the DC/OS GUI to check the status of the restart.</p>

<h6 id="pause">Pause</h6>

<p>To pause an ongoing update, issue a pause command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update pause
</code></pre></div></div>

<p>You will receive an error message if the plan has already completed or has been paused. Once completed, the plan will enter the <code class="highlighter-rouge">WAITING</code> state.</p>

<h6 id="resume">Resume</h6>

<p>If a plan is in a <code class="highlighter-rouge">WAITING</code> state, as a result of being paused or reaching a breakpoint that requires manual operator verification, you can use the <code class="highlighter-rouge">resume</code> command to continue the plan:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update resume
</code></pre></div></div>

<p>You will receive an error message if you attempt to <code class="highlighter-rouge">resume</code> a plan that is already in progress or has already completed.</p>

<h6 id="force-complete">Force Complete</h6>

<p>In order to manually “complete” a step (such that the Scheduler stops attempting to launch a task), you can issue a <code class="highlighter-rouge">force-complete</code> command. This will instruct to Scheduler to mark a specific step within a phase as complete. You need to specify both the phase and the step, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update force-complete dse-phase dse-0:[node]
</code></pre></div></div>

<h6 id="force-restart">Force Restart</h6>

<p>Similar to force complete, you can also force a restart. This can either be done for an entire plan, a phase, or just for a specific step.</p>

<p>To restart the entire plan:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update force-restart
</code></pre></div></div>

<p>Or for all steps in a single phase:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update force-restart dse-phase
</code></pre></div></div>

<p>Or for a specific step within a specific phase:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos dse update force-restart dse-phase dse-0:[node]
</code></pre></div></div>

<h4 id="open-source-dcos-dcos-19-and-earlier">Open Source DC/OS, DC/OS 1.9, and Earlier</h4>

<p>If you do not have Enterprise DC/OS 1.10 or later, the CLI commands above are not available. For Open Source DC/OS of any version, or Enterprise DC/OS 1.9 and earlier, you can perform changes from the DC/OS GUI.</p>

<ol>
  <li>
    <p>Go to the <strong>Services</strong> tab of the DC/OS GUI and click the name of the Scheduler you wish to edit.</p>
  </li>
  <li>
    <p>Click the three dots on the right hand side of the page for your Scheduler, then choose <strong>Edit</strong>.</p>
  </li>
</ol>

<p><a href="/dcos-commons/img/services/ops-guide-edit-scheduler.png"><img src="/dcos-commons/img/services/ops-guide-edit-scheduler.png" alt="Choose edit from the three dot menu" width="400" /></a></p>

<ol>
  <li>
    <p>In the window that appears, click the <strong>Environment</strong> tab to show a list of the Scheduler’s environment variables. For the sake of this demo, we will increase the <code class="highlighter-rouge">OPSCENTER_MEM</code> value from <code class="highlighter-rouge">4000</code> to <code class="highlighter-rouge">5000</code>, thereby increasing the RAM quota for the OpsCenter task in this service. See <a href="#finding-the-correct-environment-variable">finding the correct environment variable</a> for more information on determining the correct value to be updated.</p>
  </li>
  <li>After you click <code class="highlighter-rouge">Change and deploy</code>, the following will happen:
    <ul>
      <li>Marathon will restart the Scheduler so that it picks up our change.</li>
      <li>The Scheduler will detect that the OpsCenter task’s configuration has changed. The OpsCenter task will be restarted with the change applied. In this case, with allocated RAM increased from 4000 to 5000 MB.</li>
    </ul>
  </li>
  <li>We can see the result by looking at the Mesos task list. At the top we see the new <code class="highlighter-rouge">dse</code> Scheduler and new OpsCenter instance. At the bottom we see the previous <code class="highlighter-rouge">dse</code> Scheduler and OpsCenter instance which were replaced due to our change:</li>
</ol>

<p><a href="/dcos-commons/img/services/ops-guide-mesos-tasks-reconfigured.png"><img src="/dcos-commons/img/services/ops-guide-mesos-tasks-reconfigured.png" alt="dse app deployment in Mesos with exited tasks and newly launched tasks" width="400" /></a></p>

<p>If we look at the Scheduler logs, we can even see where it detected the change. The <code class="highlighter-rouge">api-port</code> value is random on each Scheduler restart, so it tends to always display as ‘different’ in this log. Because of this, the Scheduler automatically ignores changes to <code class="highlighter-rouge">api-port</code>, and so the change can be ignored here:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO  2017-04-25 20:26:08,343 [main] com.mesosphere.sdk.config.DefaultConfigurationUpdater:printConfigDiff(215): Difference between configs:
<span class="gd">--- ServiceSpec.old
</span><span class="gi">+++ ServiceSpec.new
</span><span class="gu">@@ -3,5 +3,5 @@
</span>   "role" : "dse-role",
   "principal" : "dse-principal",
<span class="gd">-  "api-port" : 18446,
</span><span class="gi">+  "api-port" : 15063,
</span>   "web-url" : null,
   "ZooKeeper" : "master.mesos:2181",
<span class="gu">@@ -40,5 +40,5 @@
</span>             "type" : "SCALAR",
             "scalar" : {
<span class="gd">-              "value" : 4000.0
</span><span class="gi">+              "value" : 5000.0
</span>             },
             "ranges" : null,
</code></pre></div></div>

<p>The steps above apply to any configuration change: the Scheduler is restarted, detects the config change, and then launches and/or restarts any affected tasks to reflect the change. When multiple tasks are affected, the Scheduler will follow the deployment Plan used for those tasks to redeploy them. In practice this typically means that each task will be deployed in a sequential rollout, where task <code class="highlighter-rouge">N+1</code> is only redeployed after task <code class="highlighter-rouge">N</code> appears to be healthy and ready after being relaunched with the new configuration. Some services may have defined a custom <code class="highlighter-rouge">update</code> plan which invokes custom logic for rolling out changes which varies from the initial deployment rollout. The default behavior, when no custom <code class="highlighter-rouge">update</code> plan was defined, is to use the <code class="highlighter-rouge">deploy</code> plan.</p>

<h5 id="finding-the-correct-environment-variable">Finding the correct environment variable</h5>

<p>While DC/OS Enterprise 1.10+ supports changing the configuration using the option schema directly, DC/OS Open and versions 1.9 and earlier require mapping those options to the environment variables that are passed to the Scheduler.</p>

<p>The correct environment variable for a given setting can vary depending on the service. For instance, some services have multiple types of nodes, each with separate count settings. If you want to increase the number of nodes, it would take some detective work to find the correct environment variable.</p>

<p>For example, let’s look at the most recent release of <code class="highlighter-rouge">confluent-kafka</code> as of this writing. The number of brokers is configured using a <a href="https://github.com/mesosphere/universe/blob/98a21f4f3710357a235f0549c3caabcab66893fd/repo/packages/C/confluent-kafka/16/config.json#L133"><code class="highlighter-rouge">count</code> setting in the <code class="highlighter-rouge">brokers</code> section</a>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"description"</span><span class="p">:</span><span class="s2">"Number of brokers to run"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"number"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"default"</span><span class="p">:</span><span class="mi">3</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>To see where this setting is passed when the Scheduler is first launched, we can look at the adjacent <a href="https://github.com/mesosphere/universe/blob/98a21f4f3710357a235f0549c3caabcab66893fd/repo/packages/C/confluent-kafka/16/marathon.json.mustache#L34"><code class="highlighter-rouge">marathon.json.mustache</code> template file</a>. Searching for <code class="highlighter-rouge">brokers.count</code> in <code class="highlighter-rouge">marathon.json.mustache</code> reveals the environment variable that we should change:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
  </span><span class="s2">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">
    </span><span class="s2">"BROKER_COUNT"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;%==%&gt;"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"..."</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This method can be used mapping any configuration setting (applicable during initial install) to its associated Marathon environment variable (applicable during reconfiguration).</p>

<h3 id="uninstall">Uninstall</h3>

<p>The uninstall flow was simplified for users as of DC/OS 1.10. The steps to uninstall a service therefore depends on the version of DC/OS:</p>

<h4 id="dcos-110-and-newer">DC/OS 1.10 and newer</h4>

<p>If you are using DC/OS 1.10 and the installed service has a version greater than 2.0.0-x:</p>

<ol>
  <li>Uninstall the service. From the DC/OS CLI, enter <code class="highlighter-rouge">dcos package uninstall --app-id=&lt;instancename&gt; &lt;packagename&gt;</code>.</li>
</ol>

<p>For example, to uninstall a Confluent Kafka instance named <code class="highlighter-rouge">kafka-dev</code>, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos package uninstall <span class="nt">--app-id</span><span class="o">=</span>kafka-dev confluent-kafka
</code></pre></div></div>

<h4 id="older-versions">Older versions</h4>

<p>If you are running DC/OS 1.9 or older, or a version of the service that is older than 2.0.0-x, follow these steps:</p>

<ol>
  <li>Stop the service. From the DC/OS CLI, enter <code class="highlighter-rouge">dcos package uninstall --app-id=&lt;instancename&gt; &lt;packagename&gt;</code>.
For example, <code class="highlighter-rouge">dcos package uninstall --app-id=kafka-dev confluent-kafka</code>.</li>
  <li>Clean up remaining reserved resources with the <code class="highlighter-rouge">janitor.py</code> script. See <a href="https://docs.mesosphere.com/1.10/deploying-services/uninstall/#framework-cleaner">DC/OS documentation</a> for more information about the cleaner script.</li>
</ol>

<p>For example, to uninstall a Confluent Kafka instance named <code class="highlighter-rouge">kafka-dev</code>, run:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ MY_SERVICE_NAME</span><span class="o">=</span>kafka-dev
<span class="nv">$ </span>dcos package uninstall <span class="nt">--app-id</span><span class="o">=</span><span class="nv">$MY_SERVICE_NAME</span> confluent-kafka<span class="sb">`</span><span class="nb">.</span>
<span class="nv">$ </span>dcos node ssh <span class="nt">--master-proxy</span> <span class="nt">--leader</span> <span class="s2">"docker run mesosphere/janitor /janitor.py </span><span class="se">\</span><span class="s2">
    -r </span><span class="nv">$MY_SERVICE_NAME</span><span class="s2">-role </span><span class="se">\</span><span class="s2">
    -p </span><span class="nv">$MY_SERVICE_NAME</span><span class="s2">-principal </span><span class="se">\</span><span class="s2">
    -z dcos-service-</span><span class="nv">$MY_SERVICE_NAME</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="pod-operations">Pod operations</h3>

<p>Most operations for maintaining a service will involve interacting with and manipulating its <a href="#pods">Pods</a>.</p>

<h4 id="add-or-remove-a-pod">Add or Remove a pod</h4>

<p>Adding or removing pod instances within the service is treated as a configuration change, not a command.</p>

<p>In this case, we’re increasing a pod count value, as provided by the service’s configuration schema. In the case of the above <code class="highlighter-rouge">dse</code> service, we need to increase the configured <code class="highlighter-rouge">dsenode.count</code> from <code class="highlighter-rouge">3</code> (the default) to <code class="highlighter-rouge">4</code>. After the change, the Scheduler will deploy a new DSE node instance without changing the preexisting nodes.</p>

<p>For safety reasons, pod instances cannot be removed after they have been deployed by default. However, some services may allow some pods to be removed in cases where doing so is not a problem. To remove pod instances, you would simply decrease the count value, and then instances exceeding that count will be removed automatically in reverse order. For example, if you decreased <code class="highlighter-rouge">dsenode.count</code> from <code class="highlighter-rouge">4</code> to <code class="highlighter-rouge">2</code> and this was allowed by the DSE service, you would see <code class="highlighter-rouge">dsenode-3</code> be removed followed by <code class="highlighter-rouge">dsenode-2</code>, leaving only <code class="highlighter-rouge">dsenode-0</code> and <code class="highlighter-rouge">dsenode-1</code> still running. If the DSE service doesn’t allow the number of instances to be decreased, the Scheduler would instead reject the decrease and show a validation error in its <a href="#status">deploy Plan</a>.</p>

<h4 id="restart-a-pod">Restart a pod</h4>

<p>Restarting a pod keeps it in the current location and leaves data in any persistent volumes as-is. Data outside of those volumes is reset via the restart. Restarting a pod may be useful if an underlying process is broken in some way and just needs a kick to get working again. For more information see <a href="../overview#recovery-plan">Recovery</a>.</p>

<p>Restarting a pod can be done either via the CLI or via the underlying Scheduler API. Both forms use the same <a href="http://mesosphere.github.io/dcos-commons/reference/swagger-api/">API</a>. In these examples we list the known pods, and then restart the one named <code class="highlighter-rouge">dse-1</code>, which contains tasks named <code class="highlighter-rouge">dse-1-agent</code> and <code class="highlighter-rouge">dse-1-node</code>:</p>

<p>Via the CLI:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos datastax-dse <span class="nt">--name</span><span class="o">=</span>mydse pod list
<span class="o">[</span>
  <span class="s2">"dse-0"</span>,
  <span class="s2">"dse-1"</span>,
  <span class="s2">"dse-2"</span>,
  <span class="s2">"opscenter-0"</span>,
  <span class="s2">"studio-0"</span>
<span class="o">]</span>
<span class="nv">$ </span>dcos datastax-dse <span class="nt">--name</span><span class="o">=</span>mydse pod restart dse-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"dse-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"dse-1-agent"</span>,
    <span class="s2">"dse-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Via the HTTP API directly:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-k</span> <span class="nt">-H</span> <span class="s2">"Authorization: token=</span><span class="k">$(</span>dcos config show core.dcos_acs_token<span class="k">)</span><span class="s2">"</span> &lt;dcos-url&gt;/service/dse/v1/pod
<span class="o">[</span>
  <span class="s2">"dse-0"</span>,
  <span class="s2">"dse-1"</span>,
  <span class="s2">"dse-2"</span>,
  <span class="s2">"opscenter-0"</span>,
  <span class="s2">"studio-0"</span>
<span class="o">]</span>
<span class="nv">$ </span>curl <span class="nt">-k</span> <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Authorization: token=</span><span class="k">$(</span>dcos config show core.dcos_acs_token<span class="k">)</span><span class="s2">"</span> &lt;dcos-url&gt;/service/dse/v1/pod/dse-1/restart
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"dse-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"dse-1-agent"</span>,
    <span class="s2">"dse-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>All tasks within the pod are restarted as a unit. The response lists the names of the two tasks that were members of the pod.</p>

<h4 id="replace-a-pod">Replace a pod</h4>

<p>Replacing a pod discards all of its current data and moves it to a new random location in the cluster. As of this writing, you can technically end up replacing a pod and have it go back where it started. Replacing a pod may be useful if an agent machine has gone down and is never coming back, or if an agent is about to undergo downtime.</p>

<p>Pod replacement is not currently done automatically by the SDK, as making the correct decision requires operator knowledge of cluster status. Is a node really dead, or will it be back in a couple minutes? However, operators are free to build their own tooling to make this decision and invoke the replace call automatically. For more information see <a href="../overview#recovery-plan">Recovery</a>.</p>

<p>As with restarting a pod, replacing a pod can be done either via the CLI or by directly invoking the HTTP API. The response lists all the tasks running in the pod which were replaced as a result:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos datastax-dse <span class="nt">--name</span><span class="o">=</span>mydse pod replace dse-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"dse-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"dse-1-agent"</span>,
    <span class="s2">"dse-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">-k</span> <span class="nt">-X</span> POST <span class="nt">-H</span> <span class="s2">"Authorization: token=</span><span class="k">$(</span>dcos config show core.dcos_acs_token<span class="k">)</span><span class="s2">"</span> http://yourcluster.com/service/dse/v1/pod/dse-1/replace
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"dse-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"dse-1-agent"</span>,
    <span class="s2">"dse-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="pause-a-pod">Pause a pod</h4>

<p>Pausing a pod relaunches it in an idle command state. This allows the operator to debug the contents of the pod, possibly making changes to fix problems. While these problems are often fixed by just replacing the pod, there may be cases where an in-place repair or other operation is needed.</p>

<p>For example:</p>
<ul>
  <li>A pod which crashes immediately upon starting may need additional work to be performed.</li>
  <li>Some services may <em>require</em> that certain repair operations be performed manually when the task itself isn’t running.
Being able to put the pod in an offline but accessible state makes it easier to resolve these situations.</li>
</ul>

<p>After the pod has been paused, it may be started again, at which point it will be restarted and will resume running task(s) where it left off.</p>

<p>Here is an example session where an <code class="highlighter-rouge">index-1</code> pod is crash looping due to some corrupted data in a persistent volume. The operator pauses the <code class="highlighter-rouge">index-1</code> pod, then uses <code class="highlighter-rouge">task exec</code> to repair the index. Following this, the operator starts the pod and it resumes normal operation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos myservice debug pod pause index-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"index-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"index-1-agent"</span>,
    <span class="s2">"index-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>

<span class="nv">$ </span>dcos myservice pod status
myservice
├─ index
│  ├─ index-0
│  │  ├─ index-0-agent <span class="o">(</span>COMPLETE<span class="o">)</span>
│  │  └─ index-0-node <span class="o">(</span>COMPLETE<span class="o">)</span>
│  └─ index-1
│     ├─ index-1-agent <span class="o">(</span>PAUSING<span class="o">)</span>
│     └─ index-1-node <span class="o">(</span>PAUSING<span class="o">)</span>
└─ data
   ├─ data-0
   │  └─ data-0-node <span class="o">(</span>COMPLETE<span class="o">)</span>
   └─ data-1
      └─ data-1-node <span class="o">(</span>COMPLETE<span class="o">)</span>

... repeat <span class="s2">"pod status"</span> <span class="k">until </span>index-1 tasks are PAUSED ...

<span class="nv">$ </span>dcos task <span class="nb">exec</span> <span class="nt">--interactive</span> <span class="nt">--tty</span> index-1-node /bin/bash
index-1-node<span class="nv">$ </span>./repair-index <span class="o">&amp;&amp;</span> <span class="nb">exit</span>

<span class="nv">$ </span>dcos myservice debug pod resume index-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"index-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"index-1-agent"</span>,
    <span class="s2">"index-1-node"</span>
  <span class="o">]</span>
<span class="o">}</span>

<span class="nv">$ </span>dcos myservice pod status
myservice
├─ index
│  ├─ index-0
│  │  ├─ index-0-agent <span class="o">(</span>RUNNING<span class="o">)</span>
│  │  └─ index-0-node <span class="o">(</span>RUNNING<span class="o">)</span>
│  └─ index-1
│     ├─ index-1-agent <span class="o">(</span>STARTING<span class="o">)</span>
│     └─ index-1-node <span class="o">(</span>STARTING<span class="o">)</span>
└─ data
   ├─ data-0
   │  └─ data-0-node <span class="o">(</span>RUNNING<span class="o">)</span>
   └─ data-1
      └─ data-1-node <span class="o">(</span>RUNNING<span class="o">)</span>

... repeat <span class="s2">"pod status"</span> <span class="k">until </span>index-1 tasks are RUNNING ...
</code></pre></div></div>

<p>In the above example, all tasks in the pod were being paused and started, but it’s worth noting that the commands also support pausing and starting individual tasks within a pod. For example, <code class="highlighter-rouge">dcos myservice debug pod pause index-1 -t agent</code> will pause only the <code class="highlighter-rouge">agent</code> task within the <code class="highlighter-rouge">index-1</code> pod.</p>

<h3 id="plan-operations">Plan Operations</h3>

<p>This lists available commands for viewing and manipulating the <a href="#plans">Plans</a> used by the Scheduler to perform work against the underlying service.</p>

<h4 id="list">List</h4>
<p>Show all plans for this service.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kakfa plan list
</code></pre></div></div>

<h4 id="status">Status</h4>
<p>Display the status of the plan with the provided plan name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan status deploy
</code></pre></div></div>

<p><strong>Note:</strong> The <code class="highlighter-rouge">--json</code> flag, though not default, is helpful in extracting phase UUIDs. Using the UUID instead of name for a
phase is a more ensures that the request, ie to pause or force-complete, is exactly the phase intended.</p>

<h4 id="start">Start</h4>
<p>Start the plan with the provided name and any optional plan arguments.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan start deploy
</code></pre></div></div>

<h4 id="stop">Stop</h4>
<p>Stop the running plan with the provided name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan stop deploy
</code></pre></div></div>

<p>Plan Pause differs from Plan Stop in the following ways:</p>
<ul>
  <li>Pause can be issued for a specific phase or for all phases within a plan. Stop can only be issued for a plan.</li>
  <li>Pause updates the underlying Phase/Step state. Stop not only updates the underlying state, but also restarts the plan.</li>
</ul>

<h4 id="pause-1">Pause</h4>
<p>Pause the plan, or a specific phase in that plan with the provided phase name (or UUID).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan pause deploy 97e70976-505f-4689-abd2-6286c4499091
</code></pre></div></div>

<p><strong>NOTE:</strong> The UUID above is an example. Use the Plan Status command with the <code class="highlighter-rouge">--json</code> flag to extract a valid UUID.</p>

<p>Plan Pause differs from Plan Stop in the following ways:</p>
<ul>
  <li>Pause can be issued for a specific phase or for all phases within a plan. Stop can only be issued for a plan.</li>
  <li>Pause updates the underlying Phase/Step state. Stop not only updated the underlying state, but also restarts the plan.</li>
</ul>

<h4 id="resume-1">Resume</h4>
<p>Resume the plan, or a specific phase in that plan, with the provided phase name (or UUID).</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan resume deploy 97e70976-505f-4689-abd2-6286c4499091
</code></pre></div></div>

<h4 id="force-restart-1">Force-Restart</h4>
<p>Restart the plan with the provided name, or a specific phase in the plan, with the provided nam, or a specific step in a
phase of the plan with the provided step name.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan force-restart deploy
</code></pre></div></div>

<h4 id="force-complete-1">Force-Complete</h4>
<p>Force complete a specific step in the provided phase. Example uses include the following: Abort a sidecar operation due
to observed failure or due to known required manual preparation that was not performed.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos kafka plan force-complete deploy
</code></pre></div></div>


</div>
</div>
</body>

</html>
