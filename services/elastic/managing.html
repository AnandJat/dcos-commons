<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Elastic: Managing</title>
<link rel="stylesheet" type="text/css" media="all" href="../../style/gh-basic.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="../../style/Dropdown.css" />
<script src="../../style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
#markdown-toc ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="../..">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="../..">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li><a href="../../developer-guide.html">SDK Developer Guide</a></li>
      
      
      
      <li><a href="../../operations-guide.html">SDK Operations Guide</a></li>
      
      
      
      <li><a href="../../faq.html">Frequently Asked Questions</a></li>
      
      
      
      <li><a href="../../glossary.html">Glossary</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="../../tutorials/kafka-tutorial.html">Kafka Tutorial</a></li>
      
      <li><a href="../../tutorials/quick-start-java.html">Quick Start (Java)</a></li>
      
      <li><a href="../../tutorials/secrets-tutorial.html">Secrets Tutorial</a></li>
      
    </ul>
  </li>
  <li>
    <span>Reference</span>
    <ul>
      
      <li><a href="../../reference/api">Javadoc Reference</a></li>
      <li><a href="../../reference/swagger-api">REST APIs</a></li>
      <li><a href="../../reference/yaml-reference.html">YAML Reference</a></li>
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          <li><a href="../../services/elastic/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/elastic/quick-start.html">Quick Start</a></li>
          
          <li><a href="../../services/elastic/upgrade.html">Upgrade</a></li>
          
          <li><a href="../../services/elastic/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/elastic/configure.html">Configuring</a></li>
          
          <li><a href="../../services/elastic/x-pack.html">X-Pack</a></li>
          
          <li><a href="../../services/elastic/connecting.html">Connecting Clients</a></li>
          
          <li><a href="../../services/elastic/backup_restore.html">Backup and Restore</a></li>
          
          <li><a href="../../services/elastic/managing.html">Managing</a></li>
          
          <li><a href="../../services/elastic/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/elastic/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/elastic/version_policy.html">Version Policy</a></li>
          
          <li><a href="../../services/elastic/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/elastic/release-notes.html">Release Notes</a></li>
          
          <li><a href="../../services/elastic/changelog.html">Changelog</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          <li><a href="../../services/hdfs/quick-start.html">Quickstart</a></li>
          
          <li><a href="../../services/hdfs/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/hdfs/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/hdfs/configure.html">Configuring</a></li>
          
          <li><a href="../../services/hdfs/release-notes.html">Release Notes</a></li>
          
          <li><a href="../../services/hdfs/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/hdfs/managing.html">Managing</a></li>
          
          <li><a href="../../services/hdfs/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/hdfs/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/hdfs/troubleshooting.html">Troubleshooting</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          <li><a href="../../services/kafka/install-and-customize.html">Install and Customize</a></li>
          
          <li><a href="../../services/kafka/quick-start.html">Quick Start</a></li>
          
          <li><a href="../../services/kafka/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/kafka/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/kafka/managing.html">Managing</a></li>
          
          <li><a href="../../services/kafka/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/kafka/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/kafka/version-policy.html">Version Policy</a></li>
          
          <li><a href="../../services/kafka/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/kafka/upgrade.html">Upgrade `1.1.26-0.10.1.0-beta` to `1.1.27-0.11.0-beta` in DC/OS 1.10</a></li>
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Elastic: Managing</h1>
<div id="content">
<h1 id="updating-configuration">Updating Configuration</h1>

<p>You can make changes to the service after it has been launched. Configuration management is handled by the scheduler process, which in turn handles deploying DC/OS Elastic Service itself.</p>

<p>After making a change, the scheduler will be restarted and will automatically deploy any detected changes to the service, one node at a time. For example, a given change will first be applied to <code class="highlighter-rouge">_NODEPOD_-0</code>, then <code class="highlighter-rouge">_NODEPOD_-1</code>, and so on.</p>

<p>Nodes are configured with a “Readiness check” to ensure that the underlying service appears to be in a healthy state before continuing with applying a given change to the next node in the sequence. However, this basic check is not foolproof and reasonable care should be taken to ensure that a given configuration change will not negatively affect the behavior of the service.</p>

<p>Some changes, such as decreasing the number of nodes or changing volume requirements, are not supported after initial deployment. See <a href="#limitations">Limitations</a>.</p>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The instructions below describe how to update the configuration for a running DC/OS service.</p>

<h2 id="enterprise-dcos-110">Enterprise DC/OS 1.10</h2>

<p>Enterprise DC/OS 1.10 introduces a convenient command line option that allows for easier updates to a service’s configuration, as well as allowing users to inspect the status of an update, to pause and resume updates, and to restart or complete steps if necessary.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
  <li>Enterprise DC/OS 1.10 or newer.</li>
  <li>Service with a version greater than 2.0.0-x.</li>
  <li><a href="https://docs.mesosphere.com/latest/cli/install/">The DC/OS CLI</a> installed and available.</li>
  <li>The service’s subcommand available and installed on your local machine.
    <ul>
      <li>You can install just the subcommand CLI by running <code class="highlighter-rouge">dcos package install --cli beta-elastic</code>.</li>
      <li>If you are running an older version of the subcommand CLI that doesn’t have the <code class="highlighter-rouge">update</code> command, uninstall and reinstall your CLI.
        <div class="language-bash highlighter-rouge"><pre class="highlight"><code>dcos package uninstall --cli beta-elastic
dcos package install --cli beta-elastic
</code></pre>
        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="preparing-configuration">Preparing configuration</h3>

<p>If you installed this service with Enterprise DC/OS 1.10, you can fetch the full configuration of a service (including any default values that were applied during installation). For example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic --name<span class="o">=</span><span class="s2">"elastic"</span> describe &gt; options.json
</code></pre>
</div>

<p>Make any configuration changes to this <code class="highlighter-rouge">options.json</code> file.</p>

<p>If you installed this service with a prior version of DC/OS, this configuration will not have been persisted by the the DC/OS package manager. You can instead use the <code class="highlighter-rouge">options.json</code> file that was used when <a href="#initial-service-configuration">installing the service</a>.</p>

<p><strong>Note:</strong> You need to specify all configuration values in the <code class="highlighter-rouge">options.json</code> file when performing a configuration update. Any unspecified values will be reverted to the default values specified by the DC/OS service. See the “Recreating <code class="highlighter-rouge">options.json</code>” section below for information on recovering these values.</p>

<h4 id="recreating-optionsjson-optional">Recreating <code class="highlighter-rouge">options.json</code> (optional)</h4>

<p>If the <code class="highlighter-rouge">options.json</code> from when the service was last installed or updated is not available, you will need to manually recreate it using the following steps.</p>

<p>First, we’ll fetch the default application’s environment, current application’s environment, and the actual template that maps config values to the environment:</p>

<ol>
  <li>Ensure you have <a href="https://stedolan.github.io/jq/">jq</a> installed.</li>
  <li>Set the service name that you’re using, for example:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">SERVICE_NAME</span><span class="o">=</span>elastic
</code></pre>
    </div>
  </li>
  <li>Get the version of the package that is currently installed:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span><span class="nv">PACKAGE_VERSION</span><span class="o">=</span><span class="k">$(</span>dcos package list | grep <span class="nv">$SERVICE_NAME</span> | awk <span class="s1">'{print $2}'</span><span class="k">)</span>
</code></pre>
    </div>
  </li>
  <li>Then fetch and save the environment variables that have been set for the service:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos marathon app show <span class="nv">$SERVICE_NAME</span> | jq .env &gt; current_env.json
</code></pre>
    </div>
  </li>
  <li>To identify those values that are custom, we’ll get the default environment variables for this version of the service:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos package describe --package-version<span class="o">=</span><span class="nv">$PACKAGE_VERSION</span> --render --app <span class="nv">$SERVICE_NAME</span> | jq .env &gt; default_env.json
</code></pre>
    </div>
  </li>
  <li>We’ll also get the entire application template:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos package describe <span class="nv">$SERVICE_NAME</span> --app &gt; marathon.json.mustache
</code></pre>
    </div>
  </li>
</ol>

<p>Now that you have these files, we’ll attempt to recreate the <code class="highlighter-rouge">options.json</code>.</p>

<ol>
  <li>Use JQ and <code class="highlighter-rouge">diff</code> to compare the two:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>diff &lt;<span class="o">(</span>jq -S . default_env.json<span class="o">)</span> &lt;<span class="o">(</span>jq -S . current_env.json<span class="o">)</span>
</code></pre>
    </div>
  </li>
  <li>Now compare these values to the values contained in the <code class="highlighter-rouge">env</code> section in application template:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>less marathon.json.mustache
</code></pre>
    </div>
  </li>
  <li>Use the variable names (e.g. ``) to create a new <code class="highlighter-rouge">options.json</code> file as described in <a href="#initial-service-configuration">Initial service configuration</a>.</li>
</ol>

<h3 id="starting-the-update">Starting the update</h3>

<p>Once you are ready to begin, initiate an update using the DC/OS CLI, passing in the updated <code class="highlighter-rouge">options.json</code> file:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic --name<span class="o">=</span><span class="s2">"elastic"</span> update start --options<span class="o">=</span>options.json
</code></pre>
</div>

<p>You will receive an acknowledgement message and the DC/OS package manager will restart the Scheduler in Marathon.</p>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<h2 id="open-source-dcos-enterprise-dcos-19-and-earlier">Open Source DC/OS, Enterprise DC/OS 1.9 and Earlier</h2>

<p>If you do not have Enterprise DC/OS 1.10 or later, the CLI commands above are not available. For Open Source DC/OS of any version, or Enterprise DC/OS 1.9 and earlier, you can perform changes from the DC/OS GUI.</p>

<!-- END DUPLICATE BLOCK -->

<p>To make configuration changes via scheduler environment updates, perform the following steps:</p>
<ol>
  <li>Visit <dcos-url> to access the DC/OS web interface.</dcos-url></li>
  <li>Navigate to <code class="highlighter-rouge">Services</code> and click on the service to be configured (default <code class="highlighter-rouge">elastic</code>).</li>
  <li>Click <code class="highlighter-rouge">Edit</code> in the upper right. On DC/OS 1.9.x, the <code class="highlighter-rouge">Edit</code> button is in a menu made up of three dots.</li>
  <li>Navigate to <code class="highlighter-rouge">Environment</code> (or <code class="highlighter-rouge">Environment variables</code>) and search for the option to be updated.</li>
  <li>Update the option value and click <code class="highlighter-rouge">Review and run</code> (or <code class="highlighter-rouge">Deploy changes</code>).</li>
  <li>The Scheduler process will be restarted with the new configuration and will validate any detected changes.</li>
  <li>If the detected changes pass validation, the relaunched Scheduler will deploy the changes by sequentially relaunching affected tasks as described above.</li>
</ol>

<p>To see a full listing of available options, run <code class="highlighter-rouge">dcos package describe --config beta-elastic</code> in the CLI, or browse the Beta Elastic install dialog in the DC/OS web interface.</p>

<h1 id="add-a-dataingestcoordinator-node">Add a Data/Ingest/Coordinator Node</h1>
<p>Increase the <code class="highlighter-rouge">DATA_NODE_COUNT</code>/<code class="highlighter-rouge">INGEST_NODE_COUNT</code>/<code class="highlighter-rouge">COORDINATOR_NODE_COUNT</code> value from the DC/OS dashboard as described in the Configuring section. This creates an update plan as described in that section. An additional node will be added as the last step of that plan.</p>

<h2 id="node-info">Node Info</h2>

<p>Comprehensive information is available about every node.  To list all nodes:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>dcos beta-elastic --name<span class="o">=</span>&lt;service-name&gt; pod list
</code></pre>
</div>

<p>To view information about a node, run the following command from the CLI.</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic --name<span class="o">=</span>&lt;service-name&gt; pod info &lt;node-id&gt;
</code></pre>
</div>

<p>For example:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic --name<span class="o">=</span>&lt;service-name&gt; pod info master-0
</code></pre>
</div>

<h2 id="node-status">Node Status</h2>
<p>Similarly, the status for any node may also be queried.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic --name<span class="o">=</span>&lt;service-name&gt; pod info &lt;node-id&gt;
</code></pre>
</div>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic pod info data-0
</code></pre>
</div>

<h1 id="upgrading-service-version">Upgrading Service Version</h1>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The instructions below show how to safely update one version of DC/OS Elastic Service to the next.</p>

<h2 id="viewing-available-versions">Viewing available versions</h2>

<p>The <code class="highlighter-rouge">update package-versions</code> command allows you to view the versions of a service that you can upgrade or downgrade to. These are specified by the service maintainer and depend on the semantics of the service (i.e. whether or not upgrades are reversal).</p>

<p>For example, run:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update package-versions
</code></pre>
</div>

<h2 id="upgrading-or-downgrading-a-service">Upgrading or downgrading a service</h2>

<ol>
  <li>Before updating the service itself, update its CLI subcommand to the new version:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos package uninstall --cli beta-elastic
<span class="gp">$ </span>dcos package install --cli beta-elastic --package-version<span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre>
    </div>
  </li>
  <li>Once the CLI subcommand has been updated, call the update start command, passing in the version. For example, to update DC/OS Elastic Service to version <code class="highlighter-rouge">1.1.6-5.0.7</code>:
    <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update start --package-version<span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre>
    </div>
  </li>
</ol>

<p>If you are missing mandatory configuration parameters, the <code class="highlighter-rouge">update</code> command will return an error. To supply missing values, you can also provide an <code class="highlighter-rouge">options.json</code> file (see <a href="#updating-configuration">Updating configuration</a>):</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update start --options<span class="o">=</span>options.json --package-version<span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre>
</div>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<!-- END DUPLICATE BLOCK -->

<h1 id="advanced-update-actions">Advanced update actions</h1>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The following sections describe advanced commands that be used to interact with an update in progress.</p>

<h2 id="monitoring-the-update">Monitoring the update</h2>

<p>Once the Scheduler has been restarted, it will begin a new deployment plan as individual pods are restarted with the new configuration. Depending on the high availability characteristics of the service being updated, you may experience a service disruption.</p>

<p>You can query the status of the update as follows:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update status
</code></pre>
</div>

<p>If the Scheduler is still restarting, DC/OS will not be able to route to it and this command will return an error message. Wait a short while and try again. You can also go to the Services tab of the DC/OS GUI to check the status of the restart.</p>

<h2 id="pause">Pause</h2>

<p>To pause an ongoing update, issue a pause command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update pause
</code></pre>
</div>

<p>You will receive an error message if the plan has already completed or has been paused. Once completed, the plan will enter the <code class="highlighter-rouge">WAITING</code> state.</p>

<h2 id="resume">Resume</h2>

<p>If a plan is in a <code class="highlighter-rouge">WAITING</code> state, as a result of being paused or reaching a breakpoint that requires manual operator verification, you can use the <code class="highlighter-rouge">resume</code> command to continue the plan:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update resume
</code></pre>
</div>

<p>You will receive an error message if you attempt to <code class="highlighter-rouge">resume</code> a plan that is already in progress or has already completed.</p>

<h2 id="force-complete">Force Complete</h2>

<p>In order to manually “complete” a step (such that the Scheduler stops attempting to launch a task), you can issue a <code class="highlighter-rouge">force-complete</code> command. This will instruct to Scheduler to mark a specific step within a phase as complete. You need to specify both the phase and the step, for example:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update force-complete service-phase service-0:[node]
</code></pre>
</div>

<h2 id="force-restart">Force Restart</h2>

<p>Similar to force complete, you can also force a restart. This can either be done for an entire plan, a phase, or just for a specific step.</p>

<p>To restart the entire plan:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update force-restart
</code></pre>
</div>

<p>Or for all steps in a single phase:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update force-restart service-phase
</code></pre>
</div>

<p>Or for a specific step within a specific phase:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dcos beta-elastic update force-restart service-phase service-0:[node]
</code></pre>
</div>

<!-- END DUPLICATE BLOCK -->

</div>
</div>
</body>

</html>
