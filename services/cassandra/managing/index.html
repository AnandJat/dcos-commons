<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Cassandra: Managing</title>
<link rel="stylesheet" type="text/css" media="all" href="/dcos-commons/style/layout.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="/dcos-commons/style/Dropdown.css" />
<script src="/dcos-commons/style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
.section-nav ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="/dcos-commons">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="/dcos-commons">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      
      <li><a href="/dcos-commons/operations-guide/">SDK Operations Guide</a></li>
      
      
      
      
      
      <li><a href="/dcos-commons/developer-guide/">SDK Developer Guide</a></li>
      
      
      
      <li><a href="/dcos-commons/yaml-reference/">YAML Reference</a></li>
      
      
      
      <li><a href="/dcos-commons/faq/">Frequently Asked Questions</a></li>
      
      
      
      <li><a href="/dcos-commons/glossary/">Glossary</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      <li><a href="/dcos-commons/reference/api">Javadoc Reference</a></li>
      <li><a href="/dcos-commons/reference/swagger-api">REST APIs</a></li>
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="/dcos-commons/tutorials/kafka-tutorial/">Kafka Tutorial</a></li>
      
      <li><a href="/dcos-commons/tutorials/secrets-tutorial/">Secrets Tutorial</a></li>
      
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Cassandra</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/service-settings/">Service Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/cassandra-settings/">Cassandra Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/node-settings/">Node Settings</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/disaster-recovery/">Disaster Recovery</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/cassandra/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/elastic/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/elastic-x-pack/">X-Pack</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/custom-elasticsearch-yaml/">Custom Elasticsearch YAML</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/disaster-recovery/">Disaster Recovery</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/elastic/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/kerberos/">Kerberos</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/hdfs/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          
          <li><a href="/dcos-commons/services/kafka/install/">Install and Customize</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/security/">Security</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/uninstall/">Uninstall</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/quick-start/">Quick Start</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/connecting-clients/">Connecting Clients</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/managing/">Managing</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/api-reference/">API Reference</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/troubleshooting/">Troubleshooting</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/limitations/">Limitations</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/supported-versions/">Supported Versions</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/release-notes/">Release Notes</a></li>
          
          
          
          <li><a href="/dcos-commons/services/kafka/upgrade/">Upgrade</a></li>
          
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Cassandra: Managing</h1>
<div id="content">

<h1 id="updating-configuration">Updating Configuration</h1>

<p>You can make changes to the service after it has been launched. Configuration management is handled by the scheduler process, which in turn handles deploying Apache Cassandra itself.</p>

<p>After making a change, the scheduler will be restarted and will automatically deploy any detected changes to the service, one node at a time. For example, a given change will first be applied to <code class="highlighter-rouge">node-0</code>, then <code class="highlighter-rouge">node-1</code>, and so on.</p>

<p>Nodes are configured with a “readiness check” to ensure that the underlying service appears to be in a healthy state before continuing with applying a given change to the next node in the sequence. However, this basic check is not foolproof and reasonable care should be taken to ensure that a given configuration change will not negatively affect the behavior of the service.</p>

<p>Some changes, such as decreasing the number of nodes or changing volume requirements, are not supported after initial deployment. See <a href="../limitations/">Limitations</a>.</p>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The instructions below describe how to update the configuration for a running DC/OS service.</p>

<h2 id="enterprise-dcos-110">Enterprise DC/OS 1.10</h2>

<p>Enterprise DC/OS 1.10 introduces a convenient command line option that allows for easier updates to a service’s configuration, as well as allowing users to inspect the status of an update, to pause and resume updates, and to restart or complete steps if necessary.</p>

<h3 id="prerequisites">Prerequisites</h3>

<ul>
  <li>Enterprise DC/OS 1.10 or newer.</li>
  <li>Service with a version greater than 2.0.0-x.</li>
  <li><a href="https://docs.mesosphere.com/latest/cli/install/">The DC/OS CLI</a> installed and available.</li>
  <li>The service’s subcommand available and installed on your local machine.
    <ul>
      <li>You can install just the subcommand CLI by running <code class="highlighter-rouge">dcos package install --cli beta-cassandra</code>.</li>
      <li>If you are running an older version of the subcommand CLI that doesn’t have the <code class="highlighter-rouge">update</code> command, uninstall and reinstall your CLI.
        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package uninstall <span class="nt">--cli</span> beta-cassandra
<span class="nv">$ </span>dcos package <span class="nb">install</span> <span class="nt">--cli</span> beta-cassandra
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
</ul>

<h3 id="preparing-configuration">Preparing configuration</h3>

<p>If you installed this service with Enterprise DC/OS 1.10, you can fetch the full configuration of a service, including any default values that were applied during installation. For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra describe <span class="o">&gt;</span> options.json
</code></pre></div></div>

<p>Make any configuration changes to this <code class="highlighter-rouge">options.json</code> file.</p>

<p>If you installed this service with a prior version of DC/OS, this configuration will not have been persisted by the the DC/OS package manager. You can instead use the <code class="highlighter-rouge">options.json</code> file that was used when <a href="#initial-service-configuration">installing the service</a>.</p>

<p><strong>Note:</strong> You must specify all configuration values in the <code class="highlighter-rouge">options.json</code> file when performing a configuration update. Any unspecified values will be reverted to the default values specified by the DC/OS service. See the “Recreating <code class="highlighter-rouge">options.json</code>” section below for information on recovering these values.</p>

<h4 id="recreating-optionsjson-optional">Recreating <code class="highlighter-rouge">options.json</code> (optional)</h4>

<p>If the <code class="highlighter-rouge">options.json</code> from when the service was last installed or updated is not available, you will need to manually recreate it using the following steps.</p>

<p>First, we’ll fetch the default application’s environment, current application’s environment, and the actual template that maps config values to the environment:</p>

<ol>
  <li>Ensure you have <a href="https://stedolan.github.io/jq/">jq</a> installed.</li>
  <li>Get the version of the package that is currently installed:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ PACKAGE_VERSION</span><span class="o">=</span><span class="k">$(</span>dcos package list | <span class="nb">grep </span>beta-cassandra | <span class="nb">awk</span> <span class="s1">'{print $2}'</span><span class="k">)</span>
</code></pre></div>    </div>
  </li>
  <li>Then fetch and save the environment variables that have been set for the service:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos marathon app show cassandra | jq .env <span class="o">&gt;</span> current_env.json
</code></pre></div>    </div>
  </li>
  <li>To identify those values that are custom, we’ll get the default environment variables for this version of the service:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package describe <span class="nt">--package-version</span><span class="o">=</span><span class="nv">$PACKAGE_VERSION</span> <span class="nt">--render</span> <span class="nt">--app</span> cassandra | jq .env <span class="o">&gt;</span> default_env.json
</code></pre></div>    </div>
  </li>
  <li>We’ll also get the entire application template:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package describe cassandra <span class="nt">--app</span> <span class="o">&gt;</span> marathon.json.mustache
</code></pre></div>    </div>
  </li>
</ol>

<p>With these files, <code class="highlighter-rouge">options.json</code> can be recreated.</p>

<ol>
  <li>Use <code class="highlighter-rouge">jq</code> and <code class="highlighter-rouge">diff</code> to compare the two:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diff &lt;<span class="o">(</span>jq <span class="nt">-S</span> <span class="nb">.</span> default_env.json<span class="o">)</span> &lt;<span class="o">(</span>jq <span class="nt">-S</span> <span class="nb">.</span> current_env.json<span class="o">)</span>
</code></pre></div>    </div>
  </li>
  <li>Now compare these values to the values contained in the <code class="highlighter-rouge">env</code> section in application template:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>less marathon.json.mustache
</code></pre></div>    </div>
  </li>
  <li>Use the variable names (e.g. <code class="highlighter-rouge">{{service.name}}</code>) to create a new <code class="highlighter-rouge">options.json</code> file as described in <a href="#initial-service-configuration">Initial service configuration</a>.</li>
</ol>

<h3 id="starting-the-update">Starting the update</h3>

<p>Once you are ready to begin, initiate an update using the DC/OS CLI, passing in the updated <code class="highlighter-rouge">options.json</code> file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update start <span class="nt">--options</span><span class="o">=</span>options.json
</code></pre></div></div>

<p>You will receive an acknowledgement message and the DC/OS package manager will restart the Scheduler in Marathon.</p>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<h3 id="open-source-dcos-enterprise-dcos-19-and-earlier">Open Source DC/OS, Enterprise DC/OS 1.9 and Earlier</h3>

<p>If you do not have Enterprise DC/OS 1.10 or later, the CLI commands above are not available. For Open Source DC/OS of any version, or Enterprise DC/OS 1.9 and earlier, you can perform changes from the DC/OS GUI.</p>

<!-- END DUPLICATE BLOCK -->

<p>To make configuration changes via scheduler environment updates, perform the following steps:</p>
<ol>
  <li>Visit <code class="highlighter-rouge">&lt;dcos-url&gt;</code> to access the DC/OS web interface.</li>
  <li>Navigate to <code class="highlighter-rouge">Services</code> and click on the service to be configured (default <code class="highlighter-rouge">cassandra</code>).</li>
  <li>Click <code class="highlighter-rouge">Edit</code> in the upper right. On DC/OS 1.9.x, the <code class="highlighter-rouge">Edit</code> button is in a menu made up of three dots.</li>
  <li>Navigate to <code class="highlighter-rouge">Environment</code> (or <code class="highlighter-rouge">Environment variables</code>) and search for the option to be updated.</li>
  <li>Update the option value and click <code class="highlighter-rouge">Review and run</code> (or <code class="highlighter-rouge">Deploy changes</code>).</li>
  <li>The Scheduler process will be restarted with the new configuration and will validate any detected changes.</li>
  <li>If the detected changes pass validation, the relaunched Scheduler will deploy the changes by sequentially relaunching affected tasks as described above.</li>
</ol>

<p>To see a full listing of available options, run <code class="highlighter-rouge">dcos package describe --config beta-cassandra</code> in the CLI, or browse the beta-cassandra package install dialog in the DC/OS web interface.</p>

<h1 id="upgrade-software">Upgrade Software</h1>

<ol>
  <li>
    <p>In the DC/OS web interface, destroy the <code class="highlighter-rouge">cassandra</code> scheduler to be updated.</p>
  </li>
  <li>
    <p>Verify that you no longer see it in the DC/OS web interface.</p>
  </li>
  <li>
    <p>Optional: Create a JSON options file with any custom configuration, such as a non-default <code class="highlighter-rouge">DEPLOY_STRATEGY</code>.</p>
  </li>
</ol>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"env"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"DEPLOY_STRATEGY"</span><span class="p">:</span><span class="w"> </span><span class="s2">"parallel-canary"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<ol>
  <li>Install the latest version of the beta-cassandra package with the specified options:</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package <span class="nb">install </span>beta-cassandra -—options<span class="o">=</span>options.json
</code></pre></div></div>

<h1 id="pod-info">Pod Info</h1>

<p>Comprehensive information is available about every pod.  To list all pods:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod list
<span class="o">[</span>
  <span class="s2">"node-0"</span>,
  <span class="s2">"node-1"</span>,
  ...
<span class="o">]</span>
</code></pre></div></div>

<p>To view information about a pod, run the following command from the CLI.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod info &lt;node-id&gt;
</code></pre></div></div>

<p>For example:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod info node-0
<span class="o">{</span>
  ... lots of JSON ...
<span class="o">}</span>
</code></pre></div></div>

<h1 id="pod-status">Pod Status</h1>
<p>Similarly, the status for any pod may also be queried.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod status &lt;node-id&gt;
</code></pre></div></div>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod status node-1
<span class="o">[</span>
  <span class="o">{</span>
    <span class="s2">"name"</span>: <span class="s2">"node-1-server"</span>,
    <span class="s2">"id"</span>: <span class="s2">"node-1-server__b31a70f4-73c5-4065-990c-76c0c704b8e4"</span>,
    <span class="s2">"state"</span>: <span class="s2">"TASK_RUNNING"</span>
  <span class="o">}</span>
<span class="o">]</span>
</code></pre></div></div>

<h1 id="pause-a-pod">Pause a pod</h1>

<p>Pausing a pod relaunches it in an idle command state. This allows the operator to debug the contents of the pod, possibly making changes to fix problems. While these problems are often fixed by just replacing the pod, there may be cases where an in-place repair or other operation is needed.</p>

<p>For example:</p>
<ul>
  <li>A pod which crashes immediately upon starting may need additional work to be performed.</li>
  <li>Some services may <em>require</em> that certain repair operations be performed manually when the task itself isn’t running.
Being able to put the pod in an offline but accessible state makes it easier to resolve these situations.</li>
</ul>

<p>After the pod has been paused, it may be started again, at which point it will be restarted and will resume running task(s) where it left off.</p>

<p>Here is an example session where a <code class="highlighter-rouge">node-1</code> pod is crash looping due to some corrupted data in a persistent volume. The operator pauses the <code class="highlighter-rouge">node-1</code> pod, then uses <code class="highlighter-rouge">task exec</code> to repair the pod. Following this, the operator starts the pod and it resumes normal operation:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra debug pod pause node-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"node-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"node-1-server"</span>
  <span class="o">]</span>
<span class="o">}</span>

<span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod status
cassandra
└─ node
   ├─ node-0
   │  └─ node-0-server <span class="o">(</span>RUNNING<span class="o">)</span>
   └─ node-1
      └─ node-1-server <span class="o">(</span>PAUSING<span class="o">)</span>

... repeat <span class="s2">"pod status"</span> <span class="k">until </span>node-1 is PAUSED ...

<span class="nv">$ </span>dcos task <span class="nb">exec</span> <span class="nt">--interactive</span> <span class="nt">--tty</span> node-1-server /bin/bash
node-1-node<span class="nv">$ </span>./repair-node <span class="o">&amp;&amp;</span> <span class="nb">exit</span>

<span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra debug pod resume node-1
<span class="o">{</span>
  <span class="s2">"pod"</span>: <span class="s2">"node-1"</span>,
  <span class="s2">"tasks"</span>: <span class="o">[</span>
    <span class="s2">"node-1-server"</span>
  <span class="o">]</span>
<span class="o">}</span>

<span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod status
cassandra
└─ node
   ├─ node-0
   │  └─ node-0-server <span class="o">(</span>RUNNING<span class="o">)</span>
   └─ node-1
      └─ node-1-server <span class="o">(</span>STARTING<span class="o">)</span>

... repeat <span class="s2">"pod status"</span> <span class="k">until </span>node-1 is RUNNING ...
</code></pre></div></div>

<p>In the above example, all tasks in the pod were being paused and started, but it’s worth noting that the commands also support pausing and starting individual tasks within a pod. For example, <code class="highlighter-rouge">dcos beta-cassandra --name=cassandra debug pod pause node-1 -t server</code> will pause only the <code class="highlighter-rouge">server</code> task within the <code class="highlighter-rouge">node-1</code> pod.</p>

<h1 id="upgrading-service-version">Upgrading Service Version</h1>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The instructions below show how to safely update one version of DC/OS Apache Cassandra Service to the next.</p>

<h2 id="viewing-available-versions">Viewing available versions</h2>

<p>The <code class="highlighter-rouge">update package-versions</code> command allows you to view the versions of a service that you can upgrade or downgrade to. These are specified by the service maintainer and depend on the semantics of the service (i.e. whether or not upgrades are reversal).</p>

<p>For example, run:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update package-versions
</code></pre></div></div>

<h2 id="upgrading-or-downgrading-a-service">Upgrading or downgrading a service</h2>

<ol>
  <li>Before updating the service itself, update its CLI subcommand to the new version:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos package uninstall <span class="nt">--cli</span> beta-cassandra
<span class="nv">$ </span>dcos package <span class="nb">install</span> <span class="nt">--cli</span> beta-cassandra <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div>    </div>
  </li>
  <li>Once the CLI subcommand has been updated, call the update start command, passing in the version. For example, to update DC/OS Apache Cassandra Service to version <code class="highlighter-rouge">1.1.6-5.0.7</code>:
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update start <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div>    </div>
  </li>
</ol>

<p>If you are missing mandatory configuration parameters, the <code class="highlighter-rouge">update</code> command will return an error. To supply missing values, you can also provide an <code class="highlighter-rouge">options.json</code> file (see <a href="#updating-configuration">Updating configuration</a>):</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update start <span class="nt">--options</span><span class="o">=</span>options.json <span class="nt">--package-version</span><span class="o">=</span><span class="s2">"1.1.6-5.0.7"</span>
</code></pre></div></div>

<p>See <a href="#advanced-update-actions">Advanced update actions</a> for commands you can use to inspect and manipulate an update after it has started.</p>

<!-- END DUPLICATE BLOCK -->

<h1 id="advanced-update-actions">Advanced update actions</h1>

<!-- THIS CONTENT DUPLICATES THE DC/OS OPERATION GUIDE -->

<p>The following sections describe advanced commands that be used to interact with an update in progress.</p>

<h2 id="monitoring-the-update">Monitoring the update</h2>

<p>Once the Scheduler has been restarted, it will begin a new deployment plan as individual pods are restarted with the new configuration. Depending on the high availability characteristics of the service being updated, you may experience a service disruption.</p>

<p>You can query the status of the update as follows:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update status
</code></pre></div></div>

<p>If the Scheduler is still restarting, DC/OS will not be able to route to it and this command will return an error message. Wait a short while and try again. You can also go to the Services tab of the DC/OS GUI to check the status of the restart.</p>

<h2 id="pause">Pause</h2>

<p>To pause an ongoing update, issue a pause command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update pause
</code></pre></div></div>

<p>You will receive an error message if the plan has already completed or has been paused. Once completed, the plan will enter the <code class="highlighter-rouge">WAITING</code> state.</p>

<h2 id="resume">Resume</h2>

<p>If a plan is in a <code class="highlighter-rouge">WAITING</code> state, as a result of being paused or reaching a breakpoint that requires manual operator verification, you can use the <code class="highlighter-rouge">resume</code> command to continue the plan:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update resume
</code></pre></div></div>

<p>You will receive an error message if you attempt to <code class="highlighter-rouge">resume</code> a plan that is already in progress or has already completed.</p>

<h2 id="force-complete">Force Complete</h2>

<p>In order to manually “complete” a step (such that the Scheduler stops attempting to launch a task), you can issue a <code class="highlighter-rouge">force-complete</code> command. This will instruct to Scheduler to mark a specific step within a phase as complete. You need to specify both the phase and the step, for example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update force-complete service-phase node-0:[task]
</code></pre></div></div>

<h2 id="force-restart">Force Restart</h2>

<p>Similar to force complete, you can also force a restart. This can either be done for an entire plan, a phase, or just for a specific step.</p>

<p>To restart the entire plan:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update force-restart
</code></pre></div></div>

<p>Or for all steps in a single phase:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update force-restart service-phase
</code></pre></div></div>

<p>Or for a specific step within a specific phase:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra update force-restart service-phase node-0:[task]
</code></pre></div></div>

<!-- END DUPLICATE BLOCK -->

<h2 id="performing-cassandra-cleanup-and-repair-operations">Performing Cassandra Cleanup and Repair Operations</h2>

<p>You may manually trigger certain <code class="highlighter-rouge">nodetool</code> operations against your Cassandra instance using the CLI or the HTTP API.</p>

<h3 id="cleanup">Cleanup</h3>

<p>You may trigger a <code class="highlighter-rouge">nodetool cleanup</code> operation across your Cassandra nodes using the <code class="highlighter-rouge">cleanup</code> plan. This plan requires the following parameters to run:</p>
<ul>
  <li><code class="highlighter-rouge">CASSANDRA_KEYSPACE</code>: the Cassandra keyspace to be cleaned up.</li>
</ul>

<p>To initiate this plan from the command line:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra --name=cassandra plan start cleanup -p CASSANDRA_KEYSPACE=space1
</code></pre></div></div>

<p>To view the status of this plan from the command line:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra --name=cassandra plan status cleanup
cleanup (IN_PROGRESS)
└─ cleanup-deploy (IN_PROGRESS)
   ├─ node-0:[cleanup] (COMPLETE)
   ├─ node-1:[cleanup] (STARTING)
   └─ node-2:[cleanup] (PENDING)
</code></pre></div></div>

<p>When the plan is completed, its status will be <code class="highlighter-rouge">COMPLETE</code>.</p>

<p>The above <code class="highlighter-rouge">plan start</code> and <code class="highlighter-rouge">plan status</code> commands may also be made directly to the service over HTTP. To see the queries involved, run the above commands with an additional <code class="highlighter-rouge">-v</code> flag.</p>

<p>For more information about <code class="highlighter-rouge">nodetool cleanup</code>, see the Cassandra documentation.</p>

<h3 id="repair">Repair</h3>

<p>You may trigger a <code class="highlighter-rouge">nodetool repair</code> operation across your Cassandra nodes using the <code class="highlighter-rouge">repair</code> plan. This plan requires the following parameters to run:</p>
<ul>
  <li><code class="highlighter-rouge">CASSANDRA_KEYSPACE</code>: the Cassandra keyspace to be cleaned up.</li>
</ul>

<p>To initiate this command from the command line:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra --name=cassandra plan start repair -p CASSANDRA_KEYSPACE=space1
</code></pre></div></div>

<p>To view the status of this plan from the command line:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra --name=cassandra plan status repair
repair (STARTING)
└─ repair-deploy (STARTING)
   ├─ node-0:[repair] (STARTING)
   ├─ node-1:[repair] (PENDING)
   └─ node-2:[repair] (PENDING)
</code></pre></div></div>

<p>When the plan is completed, its status will be <code class="highlighter-rouge">COMPLETE</code>.</p>

<p>The above <code class="highlighter-rouge">plan start</code> and <code class="highlighter-rouge">plan status</code> commands may also be made directly to the service over HTTP. To see the queries involved, run the above commands with an additional <code class="highlighter-rouge">-v</code> flag.</p>

<p>For more information about <code class="highlighter-rouge">nodetool repair</code>, see the Cassandra documentation.</p>

<h2 id="seed-nodes">Seed nodes</h2>

<p>Cassandra seed nodes are those nodes with indices smaller than the seed node count.  By default, Cassandra is deployed
with a seed node count of two.  So, node-0 and node-1 are seed nodes. When a replace operation is performed on one these
nodes, all other nodes must be restarted to be brought up to date regarding the ip address of the new seed node. This
operation is performed automatically.</p>

<p>For example if <code class="highlighter-rouge">node-0</code> needed to be replaced we would execute:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra pod replace node-0
</code></pre></div></div>

<p>which would result in a recovery plan like the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dcos beta-cassandra <span class="nt">--name</span><span class="o">=</span>cassandra plan show recovery
recovery <span class="o">(</span>IN_PROGRESS<span class="o">)</span>
└─ permanent-node-failure-recovery <span class="o">(</span>IN_PROGRESS<span class="o">)</span>
   ├─ node-0:[server] <span class="o">(</span>COMPLETE<span class="o">)</span>
   ├─ node-1:[server] <span class="o">(</span>STARTING<span class="o">)</span>
   └─ node-2:[server] <span class="o">(</span>PENDING<span class="o">)</span>
</code></pre></div></div>

<p><strong>Note:</strong> Only the seed node is being placed on a new node, all other nodes are restarted in place with no loss of data.</p>

</div>
</div>
</body>

</html>
