<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">







<head>
<title>Cassandra: Installing and Customizing</title>
<link rel="stylesheet" type="text/css" media="all" href="../../style/gh-basic.css" />
<link rel="shortcut icon" type="image/png" href="https://mesosphere.com/favicon.ico"/>
<!-- The Dropdown library is written by Stephen Morley, licensed CC0 1.0 Universal (Public Domain Dedication)-->
<link rel="stylesheet" type="text/css" media="all" href="../../style/Dropdown.css" />
<script src="../../style/Dropdown.js"></script>
<style type="text/css">
/* set the background color of menu items */
.dropdown, .dropdown ul { background: #555555; clear: both; }
/* set the background color of active items */
.dropdown li:hover > a, .dropdown li:hover > span, .dropdown li.dropdownOpen > a, .dropdown li.dropdownOpen > span { background: #af87e0; }
/* pad items, set their text color, and fade their background color */
.dropdown a, .dropdown span { padding: 0.25em 0.5em; color: white; transition: background 0.2s; }
/* show '+' on expandable items */
.dropdown span:after { content: " +"; }

/* toc style: remove extra margin between elements */
#markdown-toc ul { margin: 0; }
</style>
</head>

<body>
<div id="wrapper">

<a href="../..">
<img style="float: left; margin-bottom: 2em" src="https://mesosphere.com/wp-content/themes/mesosphere/library/images/assets/dcos-sdk-logo.png" width="250" alt="DC/OS Software Development Kit" />
</a>
<img style="float: right" src="https://img.shields.io/badge/Status-Alpha-BF97F0.svg?style=flat-square" alt="Status: Alpha" />

<ul class="dropdown" style="clear: both">
  <li>
    <a href="../..">Home</a>
  </li>
  <li>
    <span>Documentation</span>
    <ul>
      
      
      
      
      <li><a href="../../developer-guide.html">SDK Developer Guide</a></li>
      
      
      
      <li><a href="../../operations-guide.html">SDK Operations Guide</a></li>
      
      
      
      <li><a href="../../faq.html">Frequently Asked Questions</a></li>
      
      
      
      <li><a href="../../glossary.html">Glossary</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </li>
  <li>
    <span>Tutorials</span>
    <ul>
      
      
      
      <li><a href="../../tutorials/secrets-tutorial.html">Secrets Tutorial</a></li>
      
      <li><a href="../../tutorials/kafka-tutorial.html">Kafka Tutorial</a></li>
      
    </ul>
  </li>
  <li>
    <span>Reference</span>
    <ul>
      
      
      
      <li><a href="../../reference/yaml-reference.html">YAML Reference</a></li>
      
      <li><a href="../../reference/api">Javadoc Reference</a></li>
      <li><a href="../../reference/swagger-api">REST APIs</a></li>
    </ul>
  </li>
  <li>
    <span>Services</span>
    <ul>
      
      
      
      
      <li>
        
        <span>Elastic</span>
        
        <ul>
          
          
          <li><a href="../../services/elastic/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/elastic/elastic-x-pack.html">X-Pack</a></li>
          
          <li><a href="../../services/elastic/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/elastic/quick-start.html">Quick Start</a></li>
          
          <li><a href="../../services/elastic/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/elastic/managing.html">Managing</a></li>
          
          <li><a href="../../services/elastic/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/elastic/disaster-recovery.html">Disaster Recovery</a></li>
          
          <li><a href="../../services/elastic/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/elastic/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/elastic/supported-versions.html">Supported Versions</a></li>
          
          <li><a href="../../services/elastic/release-notes.html">Release Notes</a></li>
          
          <li><a href="../../services/elastic/upgrade.html">Upgrade</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>HDFS</span>
        
        <ul>
          
          
          <li><a href="../../services/hdfs/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/hdfs/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/hdfs/quick-start.html">Quickstart</a></li>
          
          <li><a href="../../services/hdfs/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/hdfs/managing.html">Managing</a></li>
          
          <li><a href="../../services/hdfs/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/hdfs/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/hdfs/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/hdfs/supported-versions.html">Supported Versions</a></li>
          
          <li><a href="../../services/hdfs/release-notes.html">Release Notes</a></li>
          
          <li><a href="../../services/hdfs/upgrade.html">Upgrade</a></li>
          
        </ul>
      </li>
      
      <li>
        
        <span>Kafka</span>
        
        <ul>
          
          
          <li><a href="../../services/kafka/install.html">Install and Customize</a></li>
          
          <li><a href="../../services/kafka/uninstall.html">Uninstall</a></li>
          
          <li><a href="../../services/kafka/quick-start.html">Quick Start</a></li>
          
          <li><a href="../../services/kafka/connecting-clients.html">Connecting Clients</a></li>
          
          <li><a href="../../services/kafka/managing.html">Managing</a></li>
          
          <li><a href="../../services/kafka/api-reference.html">API Reference</a></li>
          
          <li><a href="../../services/kafka/troubleshooting.html">Troubleshooting</a></li>
          
          <li><a href="../../services/kafka/limitations.html">Limitations</a></li>
          
          <li><a href="../../services/kafka/supported-versions.html">Supported Versions</a></li>
          
          <li><a href="../../services/kafka/release-notes.html">Release Notes</a></li>
          
          <li><a href="../../services/kafka/upgrade.html">Upgrade</a></li>
          
        </ul>
      </li>
      
    </ul>
  </li>
  <li><a href="https://github.com/mesosphere/dcos-commons/blob/master/CONTRIBUTING.md">Contributing</a></li>
  <li><a href="http://chat.dcos.io" target="_blank">Slack</a></li>
</ul>
<h1>Cassandra: Installing and Customizing</h1>
<div id="content">
<p>The default DC/OS Apache Cassandra installation provides reasonable defaults for trying out the service, but may not be sufficient for production use. You may require different configurations depending on the context of the deployment.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>If you are using Enterprise DC/OS, you may <a href="https://docs.mesosphere.com/1.9/security/service-auth/custom-service-auth/">need to provision a service account</a> before installing DC/OS Apache Cassandra. Only someone with <code class="highlighter-rouge">superuser</code> permission can create the service account.</li>
  <li><code class="highlighter-rouge">strict</code> <a href="https://docs.mesosphere.com/1.9/administration/installing/custom/configuration-parameters/#security">security mode</a> requires a service account.</li>
  <li>In <code class="highlighter-rouge">permissive</code> security mode a service account is optional.</li>
  <li><code class="highlighter-rouge">disabled</code> security mode does not require a service account.</li>
  <li>Your cluster must have at least 3 private nodes.</li>
</ul>

<h2 id="installation-from-the-dcos-cli">Installation from the DC/OS CLI</h2>

<p>To start a basic test cluster, run the following command on the DC/OS CLI. Enterprise DC/OS users must follow additional instructions. <a href="https://docs.mesosphere.com/1.9/security/service-auth/custom-service-auth/">More information about installing DC/OS Apache Cassandra on Enterprise DC/OS</a>.</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>dcos package install beta-cassandra
</code></pre>
</div>
<p>You can specify a custom configuration in an <code class="highlighter-rouge">options.json</code> file and pass it to <code class="highlighter-rouge">dcos package install</code> using the <code class="highlighter-rouge">--options</code> parameter.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ dcos package install beta-cassandra --options=&lt;options&gt;.json
</code></pre>
</div>

<p>It is recommended that this custom configuration is stored in source control.</p>

<p>For more information about building the <code class="highlighter-rouge">options.json</code> file, see the <a href="https://docs.mesosphere.com/latest/usage/managing-services/config-universe-service/">DC/OS documentation</a> for service configuration access.</p>

<h2 id="installation-from-the-dcos-web-interface">Installation from the DC/OS Web Interface</h2>

<p>You can <a href="https://docs.mesosphere.com/1.9/usage/managing-services/install/">install DC/OS Apache Cassandra from the DC/OS web interface</a>. If you install DC/OS Apache Cassandra from the web interface, you must install the DC/OS Apache Cassandra CLI subcommands separately. From the DC/OS CLI, enter:</p>
<div class="language-bash highlighter-rouge"><pre class="highlight"><code>dcos package install beta-cassandra --cli
</code></pre>
</div>
<p>Choose <code class="highlighter-rouge">ADVANCED INSTALLATION</code> to perform a custom installation.</p>

<!-- THIS BLOCK DUPLICATES THE OPERATIONS GUIDE -->

<h2 id="integration-with-dcos-access-controls">Integration with DC/OS access controls</h2>

<p>In Enterprise DC/OS 1.10 and above, you can integrate your SDK-based service with DC/OS ACLs to grant users and groups access to only certain services. You do this by installing your service into a folder, and then restricting access to some number of folders. Folders also allow you to namespace services. For instance, <code class="highlighter-rouge">staging/cassandra</code> and <code class="highlighter-rouge">production/cassandra</code>.</p>

<p>Steps:</p>

<ol>
  <li>In the DC/OS GUI, create a group, then add a user to the group. Or, just create a user. Click <strong>Organization</strong> &gt; <strong>Groups</strong> &gt; <strong>+</strong> or <strong>Organization</strong> &gt; <strong>Users</strong> &gt; <strong>+</strong>. If you create a group, you must also create a user and add them to the group.</li>
  <li>
    <p>Give the user permissions for the folder where you will install your service. In this example, we are creating a user called <code class="highlighter-rouge">developer</code>, who will have access to the <code class="highlighter-rouge">/testing</code> folder.
Select the group or user you created. Select <strong>ADD PERMISSION</strong> and then toggle to <strong>INSERT PERMISSION STRING</strong>. Add each of the following permissions to your user or group, and then click <strong>ADD PERMISSIONS</strong>.</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>dcos:adminrouter:service:marathon full
dcos:service:marathon:marathon:services:/testing full
dcos:adminrouter:ops:mesos full
dcos:adminrouter:ops:slave full
</code></pre>
    </div>
  </li>
  <li>Install your service into a folder called <code class="highlighter-rouge">test</code>. Go to <strong>Catalog</strong>, then search for <strong>beta-cassandra</strong>.</li>
  <li>
    <p>Click <strong>CONFIGURE</strong> and change the service name to <code class="highlighter-rouge">/testing/cassandra</code>, then deploy.</p>

    <p>The slashes in your service name are interpreted as folders. You are deploying Cassandra in the <code class="highlighter-rouge">/testing</code> folder. Any user with access to the <code class="highlighter-rouge">/testing</code> folder will have access to the service.</p>
  </li>
</ol>

<p><strong>Important:</strong></p>
<ul>
  <li>Services cannot be renamed. Because the location of the service is specified in the name, you cannot move services between folders.</li>
  <li>DC/OS 1.9 and earlier does not accept slashes in service names. You may be able to create the service, but you will encounter unexpected problems.</li>
</ul>

<h3 id="interacting-with-your-foldered-service">Interacting with your foldered service</h3>

<ul>
  <li>Interact with your foldered service via the DC/OS CLI with this flag: <code class="highlighter-rouge">--name=/path/to/myservice</code>.</li>
  <li>To interact with your foldered service over the web directly, use <code class="highlighter-rouge">http://&lt;dcos-url&gt;/service/path/to/myservice</code>. E.g., <code class="highlighter-rouge">http://&lt;dcos-url&gt;/service/testing/cassandra/v1/endpoints</code>.</li>
</ul>

<!-- END DUPLICATE BLOCK -->

<h1 id="multi-datacenter-deployment">Multi-datacenter Deployment</h1>

<p>To replicate data across data centers, Apache Cassandra requires that you configure each cluster with the addresses of the seed nodes from every remote cluster. Here’s what starting a multi-data-center Apache Cassandra deployment would look like, running inside of a single DC/OS cluster.</p>

<h2 id="launch-two-cassandra-clusters">Launch two Cassandra clusters</h2>

<p>Launch the first cluster with the default configuration:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>dcos package install beta-cassandra
</code></pre>
</div>

<p>Create an <code class="highlighter-rouge">options.json</code> file for the second cluster that specifies a different service name and data center name:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cassandra2"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"data_center"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dc2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Launch the second cluster with these custom options:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>dcos package install beta-cassandra --options=&lt;options&gt;.json
</code></pre>
</div>

<h2 id="get-the-seed-node-ip-addresses">Get the seed node IP addresses</h2>

<p><strong>Note:</strong> If your Cassandra clusters are not on the same network, you must set up a proxying layer to route traffic.</p>

<p>Get the list of seed node addresses for the first cluster:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>dcos cassandra endpoints node
</code></pre>
</div>

<p>Alternatively, you can get this information from the scheduler HTTP API:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="err">DCOS_AUTH_TOKEN=$(dcos</span><span class="w"> </span><span class="err">config</span><span class="w"> </span><span class="err">show</span><span class="w"> </span><span class="err">core.dcos_acs_token)</span><span class="w">
</span><span class="err">DCOS_URL=$(dcos</span><span class="w"> </span><span class="err">config</span><span class="w"> </span><span class="err">show</span><span class="w"> </span><span class="err">core.dcos_url)</span><span class="w">
</span><span class="err">curl</span><span class="w"> </span><span class="err">-H</span><span class="w"> </span><span class="s2">"authorization:token=$DCOS_AUTH_TOKEN"</span><span class="w"> </span><span class="err">$DCOS_URL/service/cassandra/v</span><span class="mi">1</span><span class="err">/endpoints/node</span><span class="w">
</span></code></pre>
</div>

<p>Your output will resemble:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"10.0.1.236:9042"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"10.0.0.119:9042"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"dns"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="s2">"node-0-server.cassandra.autoip.dcos.thisdcos.directory:9042"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"node-1-server.cassandra.autoip.dcos.thisdcos.directory:9042"</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"vip"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node.cassandra.l4lb.thisdcos.directory:9042"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Note the IPs in the <code class="highlighter-rouge">address</code> field.</p>

<p>Run the same command for your second Cassandra cluster and note the IPs in the <code class="highlighter-rouge">address</code> field:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dcos cassandra endpoints node --name=cassandra2
</code></pre>
</div>

<h2 id="update-configuration-for-both-clusters">Update configuration for both clusters</h2>

<p>Create an <code class="highlighter-rouge">options.json</code> file with the IP addresses of the first cluster (<code class="highlighter-rouge">cassandra</code>):</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"service"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"remote_seeds"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.0.1.236:9042,10.0.0.119:9042"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Update the configuration of the second cluster:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>dcos cassandra update start --options=options.json --name=cassandra2
</code></pre>
</div>

<p>Perform the same operation on the first cluster, adding the IP addresses of the second cluster’s seed nodes to the <code class="highlighter-rouge">service.remote_seeds</code> field. Then, update the first cluster’s configuration: <code class="highlighter-rouge">dcos cassandra update start --options=options.json</code>.</p>

<p>Both schedulers will restart after the configuration update, and each cluster will communicate with the seed nodes from the other cluster to establish a multi-data-center topology. Repeat this process for each new cluster you add.</p>

<p>You can monitor the progress of the update:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>dcos cassandra --name<span class="o">=</span>cassandra update status
</code></pre>
</div>

<p>Your output will resemble:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>deploy <span class="o">(</span>IN_PROGRESS<span class="o">)</span>
└─ node-deploy <span class="o">(</span>IN_PROGRESS<span class="o">)</span>
   ├─ node-0:[server] <span class="o">(</span>COMPLETE<span class="o">)</span>
   ├─ node-1:[server] <span class="o">(</span>COMPLETE<span class="o">)</span>
   └─ node-2:[server] <span class="o">(</span>PREPARED<span class="o">)</span>
</code></pre>
</div>

<h2 id="test-your-multi-datacenter-configuration">Test your multi-datacenter configuration</h2>

<p>Follow the <a href="quick-start.md">quick start guide</a> to write data to one cluster. Then, use the client on the other cluster to ensure the data has propagated.</p>

</div>
</div>
</body>

</html>
